<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joieria Online</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link rel="stylesheet" href="estiloo.css">
</head>
<body>
    <!-- HEADER -->
    <header>
        <div class="header-content">
            <h1>✨ JOIERIA ONLINE</h1>
            <div class="search-wrapper">
                <input type="text" id="searchInput" placeholder="Cercar joies...">
                <span class="search-icon">🔍</span>
            </div>
            <button class="cart-btn" onclick="toggleCart()">
                <span class="cart-icon">🛍️</span>
                <span class="cart-text">Cistell</span>
                <span class="cart-count" id="cartCount">0</span>
            </button>
        </div>
    </header>

    <!-- NAVEGACIÓ -->
    <nav>
        <div class="nav-content">
            <button class="nav-btn active" onclick="filterCategory('tots')">
                <span class="nav-icon">💎</span>
                Tots
            </button>
            <button class="nav-btn" onclick="filterCategory('anells')">
                <span class="nav-icon">💍</span>
                Anells
            </button>
            <button class="nav-btn" onclick="filterCategory('arracades')">
                <span class="nav-icon">✨</span>
                Arracades
            </button>
            <button class="nav-btn" onclick="filterCategory('polseres')">
                <span class="nav-icon">📿</span>
                Polseres
            </button>
        </div>
    </nav>

    <!-- PRODUCTES -->
    <main>
        <div class="products-grid" id="productsGrid"></div>
    </main>

    <!-- MODAL CISTELL MEJORADO -->
    <div class="cart-modal" id="cartModal" onclick="closeCartOutside(event)">
        <div class="cart-content" onclick="event.stopPropagation()">
            <div class="cart-header">
                <h2>🛍️ El Teu Cistell</h2>
                <button class="close-cart" onclick="toggleCart()">×</button>
            </div>
            <div id="cartItems"></div>
            <div class="cart-actions">
                <button class="checkout-btn" onclick="checkout()">
                    <span>💳</span>
                    Finalitzar Compra
                </button>
                <button class="clear-cart-btn" onclick="clearCart()">
                    <span>🗑️</span>
                    Buidar Cistell
                </button>
            </div>
        </div>
    </div>

    <!-- ============= JAVASCRIPT ============= -->
    <script>
        // DADES DELS PRODUCTES
        const products = [
            {
                id: 1,
                name: "Anell Diamant",
                category: "anells",
                price: 2500,
                description: "Anell d'or blanc amb diamant",
                model: "modelos/pendientes1.glb"
            },
            {
                id: 2,
                name: "Anell Safir",
                category: "anells",
                price: 1800,
                description: "Anell amb safir blau",
                model: "models/anell2.glb"
            },
            {
                id: 3,
                name: "Arracades Diamant",
                category: "arracades",
                price: 3200,
                description: "Arracades amb diamants",
                model: "models/arracades1.glb"
            },
            {
                id: 4,
                name: "Arracades Perla",
                category: "arracades",
                price: 1500,
                description: "Arracades amb perles",
                model: "models/arracades2.glb"
            },
            {
                id: 5,
                name: "Polsera Tennis",
                category: "polseres",
                price: 4500,
                description: "Polsera amb diamants",
                model: "models/polsera1.glb"
            },
            {
                id: 6,
                name: "Polsera Charm",
                category: "polseres",
                price: 980,
                description: "Polsera d'or amb charms",
                model: "models/polsera2.glb"
            }
        ];

        // ESTAT (en memòria)
        let cart = [];
        let currentCategory = 'tots';
        let searchQuery = '';

        // ============= CARREGAR MODELS 3D DE BLENDER =============
        function create3DViewer(productId, container) {
            const product = products.find(p => p.id === productId);
            
            // Crear escena Three.js
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0xFAF6F0);

            const camera = new THREE.PerspectiveCamera(
                45, 
                container.clientWidth / container.clientHeight, 
                0.1, 
                1000
            );
            camera.position.set(0, 0, 5);

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            // Llums
            const light1 = new THREE.DirectionalLight(0xffffff, 1);
            light1.position.set(5, 5, 5);
            scene.add(light1);

            const light2 = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(light2);

            // TEMPORAL: Geometria simple (substitueix amb el teu model)
            const geometry = new THREE.SphereGeometry(1, 32, 32);
            const material = new THREE.MeshStandardMaterial({ 
                color: 0xC9A961,
                metalness: 0.8,
                roughness: 0.2
            });
            const model = new THREE.Mesh(geometry, material);
            scene.add(model);

            // Animació
            function animate() {
                requestAnimationFrame(animate);
                model.rotation.y += 0.01;
                renderer.render(scene, camera);
            }
            animate();
        }

        // RENDERITZAR PRODUCTES
        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';

            let filtered = products;

            if (currentCategory !== 'tots') {
                filtered = filtered.filter(p => p.category === currentCategory);
            }

            if (searchQuery) {
                filtered = filtered.filter(p => 
                    p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    p.description.toLowerCase().includes(searchQuery.toLowerCase())
                );
            }

            if (filtered.length === 0) {
                grid.innerHTML = '<div class="no-results">❌ No hi ha productes</div>';
                return;
            }

            filtered.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <div class="product-3d" id="viewer-${product.id}"></div>
                    <div class="product-badge">NOU</div>
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-description">${product.description}</div>
                        <div class="product-price">${product.price}€</div>
                        <button class="add-to-cart" onclick="addToCart(${product.id})">
                            <span class="btn-icon">🛒</span>
                            <span class="btn-text">Afegir al Cistell</span>
                        </button>
                    </div>
                `;
                grid.appendChild(card);

                setTimeout(() => {
                    const container = document.getElementById(`viewer-${product.id}`);
                    if (container) create3DViewer(product.id, container);
                }, 100);
            });
        }

        // FILTRES
        function filterCategory(category) {
            currentCategory = category;
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.nav-btn').classList.add('active');
            renderProducts();
        }

        document.getElementById('searchInput').addEventListener('input', (e) => {
            searchQuery = e.target.value;
            renderProducts();
        });

        // CISTELL
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            cart.push(product);
            updateCartCount();
            
            const button = event.target.closest('.add-to-cart');
            button.innerHTML = '<span class="btn-icon">✓</span><span class="btn-text">Afegit!</span>';
            button.classList.add('added');
            
            setTimeout(() => {
                button.innerHTML = '<span class="btn-icon">🛒</span><span class="btn-text">Afegir al Cistell</span>';
                button.classList.remove('added');
            }, 1500);
            
            // Animación del contador
            const cartCount = document.getElementById('cartCount');
            cartCount.classList.add('bump');
            setTimeout(() => cartCount.classList.remove('bump'), 300);
        }

        function updateCartCount() {
            document.getElementById('cartCount').textContent = cart.length;
        }

        function toggleCart() {
            document.getElementById('cartModal').classList.toggle('active');
            renderCart();
        }

        function closeCartOutside(event) {
            if (event.target.id === 'cartModal') {
                toggleCart();
            }
        }

        function renderCart() {
            const container = document.getElementById('cartItems');
            
            if (cart.length === 0) {
                container.innerHTML = `
                    <div class="empty-cart">
                        <div class="empty-cart-icon">🛍️</div>
                        <div class="empty-cart-text">El cistell està buit</div>
                        <div class="empty-cart-subtext">Afegeix alguns productes per començar</div>
                    </div>
                `;
                return;
            }

            let total = 0;
            let html = '<div class="cart-items-list">';

            cart.forEach((item, index) => {
                total += item.price;
                html += `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-desc">${item.description}</div>
                            <div class="cart-item-price">${item.price}€</div>
                        </div>
                        <button class="remove-item" onclick="removeFromCart(${index})" title="Eliminar">
                            ×
                        </button>
                    </div>
                `;
            });

            html += '</div>';
            html += `
                <div class="cart-summary">
                    <div class="cart-summary-row">
                        <span>Subtotal:</span>
                        <span>${total}€</span>
                    </div>
                    <div class="cart-summary-row">
                        <span>Enviament:</span>
                        <span class="free">GRATUÏT</span>
                    </div>
                    <div class="cart-total">
                        <span>Total:</span>
                        <span>${total}€</span>
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartCount();
            renderCart();
        }

        function clearCart() {
            if (cart.length === 0) return;
            if (confirm('Estàs segur que vols buidar el cistell?')) {
                cart = [];
                updateCartCount();
                renderCart();
            }
        }

        function checkout() {
            if (cart.length === 0) {
                alert('El cistell està buit!');
                return;
            }
            alert('Redirigint a la pàgina de pagament...');
            // Aquí pots afegir la lògica de checkout
        }

        // INICIAR
        renderProducts();
    </script>
</body>
</html>
